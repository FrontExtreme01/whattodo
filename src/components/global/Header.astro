---
import { Image } from "astro:assets";
import { LogoMain, LogoHorizontal } from "@/img/allImages";
import { ArrowDown, MenuNav, Close, ChevronsRight, IconAllTours, IconCombos, IconDiscount, IconEarlyBird, IconGolf, IconParties, IconRestaurant, IconToursCategory, IconTransportation, IconYachts} from "@/img/allIcons";

import { getI18N } from "@/i18n";
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@/i18n/utils";

import LanguageSelector from "./LanguageSelector.astro";

const { currentLocale } = Astro;
const i18n = getI18N({ currentLocale });

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const navigation = [
    {
        title: t("nav.allTours"),
        link: translatePath("/get-my-experience/"),
    },
    {
        title: t("nav.tours"),
        subMenu: [
            {
                title: t("nav.lastMinute"),
                link: translatePath("/cancun-excursion-deals/"),
            },
            {
                title: t("nav.tours.cheap"),
                link: translatePath("/cheap-tours-in-cancun/"),
            },
            {
                title: t("nav.tours.favorite"),
                link: translatePath("/cancun-favorite-activities/"),
            },
            {
                title: t("nav.tours.adventure"),
                link: translatePath("/adventure-tours-in-cancun/"),
            },
            {
                title: t("nav.tours.couples"),
                link: translatePath("/tours-for-couples-in-cancun/"),
            },
            {
                title: t("nav.tours.water"),
                link: translatePath("/sailing-tours-in-cancun/"),
            },
            {
                title: t("nav.tours.ruins"),
                link: translatePath("/mayan-ruins-tours/"),
            },
            {
                title: t("nav.golf"),
                link: translatePath("/cancun-golf-courses/"),
            },
            {
                title: t("nav.yachts"),
                link: translatePath("/cancun-yacht-rentals/"),
            },
        ],
    },
    {
        title: t("nav.funParty"),
        subMenu: [
            {
                title: t("nav.funParty.nightClubs"),
                link: translatePath("/nightlife-in-cancun/"),
            },
            {
                title: t("nav.funParty.beachClub"),
                link: translatePath("/beachclub-in-cancun/"),
            },
        ],
    },
    {
        title: t("nav.earlyBirds"),
        link: translatePath("/cancun-early-birds/"),
    },
    {
        title: t("nav.rest"),
        link: translatePath("/restaurant/"),
    },
    {
        title: t("nav.transportation"),
        link: translatePath("/airport-transfer-cancun/"),
    },
    {
        title: t("nav.combos"),
        link: translatePath("/combos/"),
    },
];

const navigationMobile = [
    {
        icon: IconAllTours,
        title: t("nav.allTours"),
        link: translatePath("/get-my-experience/"),
    },
    {
        icon: IconToursCategory,
        title: t("nav.tours"),
        subMenu: [
            {
                icon: IconDiscount,
                title: t("nav.lastMinute"),
                link: translatePath("/cancun-excursion-deals/"),
            },
            {
                title: t("nav.tours.cheap"),
                link: translatePath("/cheap-tours-in-cancun/"),
            },
            {
                title: t("nav.tours.favorite"),
                link: translatePath("/cancun-favorite-activities/"),
            },
            {
                title: t("nav.tours.adventure"),
                link: translatePath("/adventure-tours-in-cancun/"),
            },
            {
                title: t("nav.tours.couples"),
                link: translatePath("/tours-for-couples-in-cancun/"),
            },
            {
                title: t("nav.tours.water"),
                link: translatePath("/sailing-tours-in-cancun/"),
            },
            {
                title: t("nav.tours.ruins"),
                link: translatePath("/mayan-ruins-tours/"),
            },
        ],
    },
    {
        icon: IconParties,
        title: t("nav.funParty"),
        subMenu: [
            {
                title: t("nav.funParty.nightClubs"),
                link: translatePath("/nightlife-in-cancun/"),
            },
            {
                title: t("nav.funParty.beachClub"),
                link: translatePath("/beachclub-in-cancun/"),
            },
        ],
    },
    {
        icon: IconEarlyBird,
        title: t("nav.earlyBirds"),
        link: translatePath("/cancun-early-birds/"),
    },
    {
        icon: IconRestaurant,
        title: t("nav.rest"),
        link: translatePath("/restaurant/"),
    },
    {
        icon: IconTransportation,
        title: t("nav.transportation"),
        link: translatePath("/airport-transfer-cancun/"),
    },
    {
        icon: IconCombos,
        title: t("nav.combos"),
        link: translatePath("/combos/"),
    },
    {
        icon: IconGolf,
        title: t("nav.golf"),
        link: translatePath("/cancun-golf-courses/"),
    },
    {
        icon: IconYachts,
        title: t("nav.yachts"),
        link: translatePath("/cancun-yacht-rentals/"),
    },
];
---

<header id="main-header" class="bg-white sticky z-20 shadow border border-gray-200 rounded-full mx-2 md:mx-6 transition-transform ease-in duration-300">
    <!-- Desktop Navbar-->
    <nav class="mx-auto flex items-center justify-between px-2 xl:px-8" aria-label="Global">
        <!-- Logo -->
        <div class="order-2 xl:order-none flex sm:flex-1">
            <a
                href={translatePath("/")}
                aria-label={i18n.ACCESSIBILITY.GO_TO_HOME}
                class="mx-auto p-1.5"
            >
                <span class="sr-only">What To Do In Cancun</span>
                <Image
                    src={LogoMain}
                    alt="logo what to do in cancun"
                    class="hidden xl:block h-20 w-auto object-contain"
                    widths={[240, 500, 720, LogoMain.width]}
                    sizes={`(max-width: 360px) 240px, (max-width: 720px) 500px, (max-width: 1600px) 720px, ${LogoMain.width}px`}
                />
                <Image
                    src={LogoHorizontal}
                    alt="logo what to do in cancun"
                    class="block xl:hidden w-full h-auto"
                    widths={[240, 500, 720, LogoHorizontal.width]}
                    sizes={`(max-width: 360px) 240px, (max-width: 720px) 500px, (max-width: 1600px) 720px, ${LogoHorizontal.width}px`}
                />
            </a>
        </div>
        <!-- Navbar -->
        <div class="hidden xl:flex xl:space-x-8">
            {
                navigation.map((nav) =>
                    nav.subMenu ? (
                        <div class="relative group">
                            <span class="text-green-700 text-base hover:text-orange-500 font-bold leading-6">
                                {nav.title}
                                <ArrowDown class="w-6 h-6 inline-block mr-2 text-green-700 group-hover:rotate-180 transition-all duration-200" />
                            </span>
                            <div class="hidden group-hover:block absolute top-full -left-10 bg-white shadow-lg py-4 px-6 rounded-lg">
                                {nav.subMenu.map((category) => (
                                    <a
                                        href={category.link}
                                        class={`${category.title === t("nav.lastMinute") ? "text-red-600 relative" : "text-green-700"} text-base hover:text-orange-500 font-bold leading-10 w-max block`}
                                    >
                                        {category.title}
                                    </a>
                                ))}
                            </div>
                        </div>
                    ) : (
                        <a
                            href={nav.link}
                            class={`${nav.title === t("nav.earlyBirds") ? "text-red-600 relative" : "text-green-700"} text-base hover:text-orange-500 font-bold leading-6`}
                        >
                            {nav.title}
                            {nav.title === t("nav.earlyBirds") && (
                                <span class="absolute -top-6 -right-5 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full">{t("text.new")}</span>
                            )}  
                        </a>
                    ),
                )
            }
        </div>
        <!-- Button Open Menu Mobile -->
        <div class="order-3 xl:order-none flex sm:flex-1 justify-center xl:hidden">
            <button type="button" class="text-gray-700 navbarMobile">
                <span class="sr-only">{i18n.ACCESSIBILITY.OPEN_MENU}</span>
                <MenuNav class="w-5 h-5 mx-4" />
            </button>
        </div>
        <!-- Button Translate -->
        <div class="order-1 xl:order-none flex sm:flex-1 justify-center items-center xl:ml-2">
            <LanguageSelector />
        </div>
    </nav>

    <!-- Mobile Navbar -->
    <nav class="flex xl:hidden flex-column relative">
        <div class="fixed top-0 left-0 bg-black/[.50] w-full h-full z-[100] overlayMobile"></div>
        <div class="menuMobile z-[110]">
            <span class="btnClose absolute top-5 right-2 z-[120] transition duration-400 cursor-pointer text-gray-800 rounded-full grid place-items-center">
                <Close class="w-5 h-5" />
            </span>
            <div class="bg-white h-full py-10 px-5 min-h-96 overflow-y-scroll">
                <a href={translatePath("/")} aria-label={i18n.ACCESSIBILITY.GO_TO_HOME}>
                    <Image
                        src={LogoMain}
                        alt={i18n.ACCESSIBILITY.LOGO}
                        class="max-h-24 h-auto w-auto mb-14 mx-auto"
                        widths={[240, 500, 720, LogoMain.width]}
                        sizes={`(max-width: 360px) 240px, (max-width: 720px) 500px, (max-width: 1600px) 720px,  ${LogoMain.width}px`}
                    />
                </a>
                <div class="flex flex-col space-y-7">
                    {navigationMobile.map((nav, index) =>
                        nav.subMenu ? (
                        <div class="group">
                            <span id={`nav-link-${index}`} class="text-green-700 text-lg hover:text-orange-500 font-bold leading-6 flex items-center cursor-pointer">
                                <nav.icon class="size-6 inline-block mr-2" />
                                {nav.title}
                                <ArrowDown class="svgArrowDown size-6 inline-block mr-2 text-green-700 transition-all duration-200" />
                            </span>
                            <div id={`sub-menu-${index}`} class="flex flex-col gap-y-4 pl-5 overflow-hidden h-0 transition-all duration-300">
                                {nav.subMenu.map((category) => (
                                    <a href={category.link} class={`${category.title === t("nav.lastMinute") ? "text-red-600 relative" : "text-green-700"} text-base hover:text-orange-500 font-bold leading-6 flex items-center`}>
                                        {category.icon ? <category.icon class="size-6 inline-block mr-2" /> : <ChevronsRight class="size-6 inline-block mr-2 text-green-600" /> } {category.title}
                                    </a>
                                ))}
                            </div>
                        </div>
                        ) : (
                            <a href={nav.link} class={`${nav.title === t("nav.earlyBirds") ? "text-red-600 relative" : "text-green-700"} text-lg hover:text-orange-500 font-bold leading-6 flex items-center`}>
                                <nav.icon class="size-6 inline-block mr-2" />
                                {nav.title}
                                {nav.title === t("nav.earlyBirds") && (
                                    <span class="absolute -top-5 right-10 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full">{t("text.new")}</span>
                                )}
                            </a>
                        ))
                    }
                </div>
            </div>
        </div>
    </nav>
</header>