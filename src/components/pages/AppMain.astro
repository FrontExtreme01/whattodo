---
import { getI18N,  } from "@/i18n";
import { getLangFromUrl, useTranslatedPath } from "@/i18n/utils";
import { getCollectionHome, getToursHome, getTypeDeal } from "@/content/functions";
import { Review1, Review2, Review3, Review4, Review5 } from "@/img/allImages";
import { MenuGrid, Heart, Users, Pyramid, Swimming, DiscountCheap, IconAtvOutline, ArrowUpRight } from "@/img/allIcons";
import { getSlides } from "@/img/allSlides";

import BaseLayout from "@/layouts/BaseLayout.astro";
import SliderDesktop from "@components/global/SliderDesktop";
import SliderMobile from "@components/global/SliderMobile";
import Partners from "@components/global/Partners";
import Testimonials from "@components/global/Testimonials";
import CardRest from "@components/cards/RestaurantCard.astro";
import CardTour from "@components/cards/TourCard.astro";
import CardParty from "@components/cards/PartyCard.astro";

const { currentLocale } = Astro;
const i18n = getI18N({ currentLocale });

const lang = getLangFromUrl(Astro.url);
const translatePath = useTranslatedPath(lang);

const slidesDesktop = getSlides("HOME", "DESKTOP", lang);
const slidesMobile = getSlides("HOME", "MOBILE", lang);

const restaurantsHome = await getCollectionHome("restaurants", lang);
const toursHome = await getToursHome(lang);
const partyHome = await getCollectionHome("parties", lang);
const lastMinute = await getTypeDeal("lastMinute", lang);

const testimonials = [
    {image: Review1, user: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_1.USER, stars: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_1.STARS, date: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_1.DATE, title: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_1.TITLE, review: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_1.REVIEW },
    {image: Review2, user: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_2.USER, stars: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_2.STARS, date: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_2.DATE, title: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_2.TITLE, review: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_2.REVIEW },
    {image: Review3, user: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_3.USER, stars: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_3.STARS, date: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_3.DATE, title: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_3.TITLE, review: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_3.REVIEW },
    {image: Review4, user: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_4.USER, stars: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_4.STARS, date: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_4.DATE, title: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_4.TITLE, review: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_4.REVIEW },
    {image: Review5, user: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_5.USER, stars: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_5.STARS, date: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_5.DATE, title: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_5.TITLE, review: i18n.HOME_PAGE.TESTIMONIALS.TESTIMONIAL_5.REVIEW },
]

const seoMetaDatos = {
	description: i18n.SEO.HOME_PAGE.DESCRIPTION,
    keywords: i18n.SEO.HOME_PAGE.KEYWORDS,
    image: slidesDesktop[0].image.src,
}
---	

<BaseLayout seo={seoMetaDatos}>
    <SliderDesktop client:visible slides={slidesDesktop} lang={lang} />
    <SliderMobile client:visible slides={slidesMobile} lang={lang} />

    <!-- Categories -->
    <section class="container mx-auto px-5 md:px-20 py-6">
        <h2 class="text-gray-800 text-xl md:text-3xl font-bold mb-5">{i18n.HOME_PAGE.CATEGORIES.TITLE}</h2>
        <div class="flex gap-4 lg:justify-start xl:justify-between lg:flex-wrap w-full py-3 overflow-x-scroll scrollbar-none">
            <a class="whitespace-nowrap group text-sm sm:text-lg font-semibold bg-white hover:bg-green-700 text-gray-800 hover:text-white shadow-md px-4 py-2 lg:px-6 lg:py-3 rounded-full flex items-center" href={translatePath('/get-my-experience/')} aria-label="">
                <MenuGrid class="size-8 text-green-700 group-hover:text-white mr-1" stroke-width={1.3} /> {i18n.HOME_PAGE.CATEGORIES.ALL_TOURS}
            </a>
            <a class="whitespace-nowrap group text-sm sm:text-lg font-semibold bg-white hover:bg-green-700 text-gray-800 hover:text-white shadow-md px-4 py-2 lg:px-6 lg:py-3 rounded-full flex items-center" href={translatePath('/cheap-tours-in-cancun/')} aria-label="">
                <DiscountCheap class="size-8 text-green-700 group-hover:text-white mr-1" stroke-width={1.3} /> {i18n.HOME_PAGE.CATEGORIES.CHEAP}
            </a>
            <a class="whitespace-nowrap group text-sm sm:text-lg font-semibold bg-white hover:bg-green-700 text-gray-800 hover:text-white shadow-md px-4 py-2 lg:px-6 lg:py-3 rounded-full flex items-center" href={translatePath('/adventure-tours-in-cancun/')} aria-label="">
                <IconAtvOutline class="size-8 text-green-700 group-hover:text-white mr-1" stroke-width={1} /> {i18n.HOME_PAGE.CATEGORIES.ADVENTURE}
            </a>
            <a class="whitespace-nowrap group text-sm sm:text-lg font-semibold bg-white hover:bg-green-700 text-gray-800 hover:text-white shadow-md px-4 py-2 lg:px-6 lg:py-3 rounded-full flex items-center" href={translatePath('/cancun-favorite-activities/')} aria-label="">
                <Heart class="size-8 text-green-700 group-hover:text-white mr-1" stroke-width={1.3} /> {i18n.HOME_PAGE.CATEGORIES.FAVORITES}
            </a>
            <a class="whitespace-nowrap group text-sm sm:text-lg font-semibold bg-white hover:bg-green-700 text-gray-800 hover:text-white shadow-md px-4 py-2 lg:px-6 lg:py-3 rounded-full flex items-center" href={translatePath('/tours-for-couples-in-cancun/')} aria-label="">
                <Users class="size-8 text-green-700 group-hover:text-white mr-1" stroke-width={1.3} /> {i18n.HOME_PAGE.CATEGORIES.COUPLES}
            </a>
            <a class="whitespace-nowrap group text-sm sm:text-lg font-semibold bg-white hover:bg-green-700 text-gray-800 hover:text-white shadow-md px-4 py-2 lg:px-6 lg:py-3 rounded-full flex items-center" href={translatePath('/sailing-tours-in-cancun')} aria-label="">
                <Swimming class="size-8 text-green-700 group-hover:text-white mr-1" stroke-width={1.3} /> {i18n.HOME_PAGE.CATEGORIES.WATER}
            </a>
            <a class="whitespace-nowrap group text-sm sm:text-lg font-semibold bg-white hover:bg-green-700 text-gray-800 hover:text-white shadow-md px-4 py-2 lg:px-6 lg:py-3 rounded-full flex items-center" href={translatePath('/mayan-ruins-tours/')} aria-label="">
                <Pyramid class="size-8 text-green-700 group-hover:text-white mr-1" stroke-width={1.3} /> {i18n.HOME_PAGE.CATEGORIES.RUINS}
            </a>
        </div>
    </section>

    <!-- Recommended -->
    <section class="container mx-auto px-5 md:px-20 py-6">
        <div class="flex items-center justify-between mb-5">
            <h2 class="text-gray-800 text-xl md:text-3xl font-bold w-fit">{i18n.HOME_PAGE.TOP_RATED}</h2>
            <a class="text-gray-500 font-semibold hover:text-green-700 text-base md:text-xl w-fit flex items-center" href={translatePath('/get-my-experience/')} aria-label="">
                {i18n.HOME_PAGE.SEE_ALL}
                <ArrowUpRight class="ml-1 size-4 sm:size-6" />
            </a>
        </div>
        <div class="flex gap-x-4 pb-5 snap-x snap-mandatory overflow-x-auto lg:flex-wrap lg:gap-0 lg:pb-0 lg:snap-none scrollbar-none">
            {toursHome.map((tour) => <CardTour tour={tour} lang={lang} /> )}
            <div class="snap-start shrink-0 w-16 ml-2 lg:hidden"></div>
        </div>
    </section>

    <!-- Top Parties -->
    <section class="container mx-auto px-5 md:px-20 py-6">
        <div class="flex items-center justify-between mb-5">
            <h2 class="text-gray-800 text-xl md:text-3xl font-bold w-fit">{i18n.HOME_PAGE.PARTIES}</h2>
            <a class="text-gray-500 font-semibold hover:text-green-700 text-base md:text-xl w-fit flex items-center" href={translatePath('/nightlife-in-cancun/')} aria-label="">
                {i18n.HOME_PAGE.SEE_ALL}
                <ArrowUpRight class="ml-1 size-4 sm:size-6" />
            </a>
        </div>
        <div class="flex gap-x-4 pb-5 snap-x snap-mandatory overflow-x-auto lg:flex-wrap lg:gap-0 lg:pb-0 lg:snap-none scrollbar-none">
            {partyHome.map((party) => <CardParty party={party} lang={lang} />)}
            <div class="snap-start shrink-0 w-16 ml-2 lg:hidden"></div>
        </div>
    </section>

    <!-- Section LastMinute -->
    <section class="relative overflow-hidden">
        <div class="bg-[url('/assets/backgrounds/background-lastminute.jpg')] bg-no-repeat bg-cover bg-center absolute inset-0 z-0 blur-sm"></div>
        <div class="bg-gradient-to-b from-[#00AAFF]/50 to-[#192F5D]/50 absolute inset-0 w-full h-full z-[1]"></div>
        <div class="container mx-auto px-5 md:px-20 pb-14 relative z-[1]">
            <div class="flex items-center justify-between mb-8 sm:mb-5">
                <h2 class="rounded-b-3xl p-4 sm:pt-7 sm:pb-5 sm:px-5 bg-gradient-to-r from-red-600 from-70% to-orange-500 text-white text-xl md:text-3xl font-bold w-fit">{i18n.HOME_PAGE.LAST_MINUTE}</h2>
                <a class="text-white font-semibold hover:text-gray-800 text-base md:text-xl w-fit flex items-center" href={translatePath('/cancun-excursion-deals/')} aria-label="">
                    {i18n.HOME_PAGE.SEE_ALL}
                    <ArrowUpRight class="ml-1 size-4 sm:size-6" />
                </a>
            </div>
            <div class="flex gap-x-4 pb-5 snap-x snap-mandatory overflow-x-auto lg:flex-wrap lg:gap-0 lg:pb-0 lg:snap-none scrollbar-none">
                {lastMinute.map((entry) => {
                    if (entry.collection === 'tours') {
                        return <CardTour tour={entry} lang={lang} />;
                    } else if (entry.collection === 'parties') {
                        return <CardParty party={entry} lang={lang} />;
                    }
                })}
                <div class="snap-start shrink-0 w-16 ml-2 lg:hidden"></div>
            </div>
        </div>
    </section>

    <!-- Top Restaurants -->
    <section class="container mx-auto px-5 md:px-20 pb-6 pt-14">
        <div class="flex items-center justify-between mb-5">
            <h2 class="text-gray-800 text-xl md:text-3xl font-bold w-fit">{i18n.HOME_PAGE.RESTAURANTS}</h2>
            <a class="text-gray-500 font-semibold hover:text-green-700 text-base md:text-xl w-fit flex items-center" href={translatePath('/restaurant/')} aria-label="">
                {i18n.HOME_PAGE.SEE_ALL}
                <ArrowUpRight class="ml-1 size-4 sm:size-6" />
            </a>
        </div>
        <div class="flex gap-x-4 pb-5 snap-x snap-mandatory overflow-x-auto lg:flex-wrap lg:gap-0 lg:pb-0 lg:snap-none scrollbar-none">
            {restaurantsHome.map((rest) => <CardRest restaurant={rest} lang={lang} />)}
            <div class="snap-start shrink-0 w-16 ml-2 lg:hidden"></div>
        </div>
    </section>

    <Testimonials client:visible testimonials={testimonials} title={i18n.HOME_PAGE.TESTIMONIALS.TITLE} description={i18n.HOME_PAGE.TESTIMONIALS.DESCRIPTION} />

    <Partners client:visible title={i18n.PARTNERS.TITLE} description={i18n.PARTNERS.DESCRIPTION} />
</BaseLayout>